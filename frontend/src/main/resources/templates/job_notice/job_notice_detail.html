<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/job_notice/job_notice_detail.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div th:replace="~{fragment/header :: userHeader}"></div>
<main>

    <div class="main-container">

        <!--    이미지-->
        <div class="img-container">
            <div class="grid-item" th:each="file : ${jobNotice.fileList}">
                    <img class="grid-image" th:src="${file.fileUrl + file.fileNewName + file.fileExt}"
                         onerror="this.src='/static/img/default_image.png'">
            </div>

            <div class="grid-item" th:if="${jobNotice.fileList.size() < 3}"
                 th:each="i : ${#numbers.sequence(1, 3 - jobNotice.fileList.size())}">
                <img class="grid-image" src="/static/img/default_image.png">
            </div>
        </div>

        <!--    제목-->
        <div class="title-container">
            <div class="left-title">
                <div class="top-left">
                    <p th:text="${jobNotice.companyName}+'&nbsp;|&nbsp;'+${jobNotice.jobNoticeArea}+'&nbsp;|&nbsp;'+${jobNotice.careerName}"></p>
                </div>
                <div class="bottom-left">
                    <h3 th:text="${jobNotice.jobNoticeTitle}"></h3>
                </div>
            </div>
            <div class="right-title">
                <div class="top-right">
                    <i id="like" th:class="${(jobNotice.likeYn > 0 ? 'fas' : 'far') + ' fa-heart'}" style="font-size: 1.5rem;" th:data-jobNoticeNum="${jobNotice.jobNoticeNum}"></i>
                    <button onclick="" id="apply-btn">지원하기</button>
                </div>
                <div class="bottom-right">
                    <p th:text="'조회수 : '+${jobNotice.vCnt+1}"></p>
                    <p th:text="'작성일 : '+ ${@dateUtil.formatYearMonthDay(jobNotice.instDt)}"></p>
                </div>
            </div>
        </div>

        <div class="detail-content">
            <table id="detail-table">
                <tr>
                    <td class="name" th:text="경력"></td>
                    <td class="table-content" th:text="${jobNotice.careerName}"></td>
                    <td class="name" th:text="급여"></td>
                    <td class="table-content" th:text="${jobNotice.jobNoticePay}"></td>
                </tr>
                <tr>
                    <td class="name" th:text="학력"></td>
                    <td class="table-content" th:text="${jobNotice.educationName}"></td>
                    <td class="name" th:text="근무일"></td>
                    <td class="table-content" th:text="${jobNotice.jobNoticeWorktime}"></td>
                </tr>
                <tr>
                    <td class="name" th:text="근무형태"></td>
                    <td class="table-content" th:text="${jobNotice.workName}"></td>
                    <td class="name" th:text="근무지역"></td>
                    <td class="table-content" th:text="${jobNotice.jobNoticeArea}"></td>
                </tr>
            </table>
        </div>

        <div class="main-content">
            <div class="mn-form" id="jobNoticeDetail">
                <h3>모집부문 및 상세내용</h3>
                <p th:text="${jobNotice.jobNoticeDetail}"></p>
            </div>
            <div class="mn-form" id="jobNoticeWorkJogun">
                <h3>근무조건</h3>
                <p th:text="${jobNotice.jobNoticeWorkJogun}"></p>
            </div>
            <div class="mn-form" id="step">
                <h3>채용절차</h3>
                <div id="stepIcon">
                    <button class="default-step">서류전형</button>
                    <div class="line"></div>
                    <th:block th:each="step : ${jobNotice.stepList}">
                        <button class="add-step" th:text="${step}"></button>
                        <div class="line"></div>
                    </th:block>
                    <button class="default-step">최종합격</button>
                </div>
            </div>
            <div class="mn-form" id="jobNoticeWay">
                <h3>접수기간 및 방법</h3>
                <p th:text="${jobNotice.jobNoticeWay}"></p>
            </div>
            <div class="mn-form" id="jobNoticeCaution">
                <h3>유의사항</h3>
                <p th:text="${jobNotice.jobNoticeCaution}"></p>
            </div>
        </div>
        <hr>
        <div class="bottom-content">
            <div class="bottom-form" id="welfare">
                <h3>복리후생</h3>
                <div id="welfare-content">
                    <th:block th:each="welfare : ${jobNotice.welfareList}">
                        <span th:text="${welfare}"></span>
                    </th:block>
                </div>
            </div>
            <div class="bottom-form" id="stack">
                <h3>기술 스택</h3>
                <div id="stack-content">
                    <th:block th:each="stack : ${jobNotice.stackList}">
                        <button th:text="${stack}"></button>
                    </th:block>
                </div>
            </div>
            <div class="bottom-form" id="notice-period">
                <h3>채용기간</h3>
                <div id="str-btn-container">
                    <button id="str-btn" th:text="시작일"></button>
                    <span th:text="${jobNotice.jobNoticeStrDate}"></span>
                </div>
                <div id="end-btn-container">
                    <button id="end-btn" th:text="마감일"></button>
                    <span th:text="${jobNotice.jobNoticeEndDate}"></span>
                </div>
            </div>
        </div>
        <hr>

        <div class="board">
            <div id="board-content">
                <span>궁금하신 내용을 입력해주시면</span>
                <span> 명확히 신속하게 전달 드리겠습니다. </span>
            </div>
            <div id="board-icon">
                <p>1:1 문의하기<i class="bi bi-arrow-up-right-circle"></i></p>
                <!--                <i id="mailbox" class="bi bi-mailbox"></i>-->
            </div>
        </div>

        <hr>

        <div class="apply">
            <h3>지원현황</h3>
            <th:block th:each="applyStatus : ${applyStatusList}">
                <div id="apply-con">
                    <div id="apply-one">
                        <div id="apply-left">
                            <p id="name" th:text="${applyStatus.name}"></p>
                            <p id="apply-left-content"
                               th:text="${applyStatus.genderCd}+'&nbsp;|&nbsp;'+${applyStatus.resumeTitle}"></p>
                        </div>
                        <div id="apply-right">
                            <p id="apply-dt" th:text="'작성일 : ' + ${@dateUtil.formatYearMonthDayLocalDateTime(applyStatus.instDt)}"></p>
                            <div id="right-bottom">
                                <th:block th:each="stack:${applyStatus.stackCdList}">
                                    <button class="stack-btns" th:text="${stack}"></button>
                                </th:block>
                            </div>
                        </div>
                    </div>
                    <div id="apply-check">
                        <select class="jobNoticeWorkGbnCd" th:data-jobNoticeNum="${applyStatus.jobNoticeNum}" th:data-resumeId="${applyStatus.resumeId}">
                            <th:block th:each="applyGbnCd : ${applyGbnCdList}">
                                <option th:value="${applyGbnCd.cd}"
                                        th:text="${applyGbnCd.cdNm}"
                                        th:selected="${applyStatus.applyGbnCd == applyGbnCd.cd}"></option>
                            </th:block>
                        </select>
                    </div>
                </div>
            </th:block>
        </div>

    </div>
</main>
<div th:replace="~{fragment/footer :: footer}"></div>
</body>
<script>

    //지원현황 업데이트
    document.body.addEventListener("change", function (event) {
        if (event.target.classList.contains("jobNoticeWorkGbnCd")) {
            const selectedValue = event.target.value; // 선택한 값
            const jobNoticeNum = event.target.dataset.jobnoticenum;
            const resumeId = event.target.dataset.resumeid;

            const dto = {
                jobNoticeNum: parseInt(jobNoticeNum, 10),
                resumeId: resumeId,
                applyGbnCd: selectedValue
            };

            api.put('/api/v1/apply-status', dto)
                .then(response => {
                    console.log('Success:', response.data);
                    alert('상태가 변경 완료되었습니다.');
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('오류가 발생했습니다. 다시 시도해주세요.');
                });
        }
    });


    //스크랩 등록
    document.getElementById("like").addEventListener("click", function () {
        let param = {
            target: this.getAttribute("data-jobNoticeNum"),
            likeGbnCd: "30",
            likedStatus: this.classList.contains("fas"),
        };

        if (confirm(param.likedStatus ? "스크랩을 취소 하시겠습니까?" : "스크랩으로 등록 하시겠습니까?")) {
            api.post("/api/v1/like", param)
                .then(data => {
                    if (param.likedStatus) {
                        this.classList.remove('fas');
                        this.classList.add('far');
                    } else {
                        this.classList.remove('far');
                        this.classList.add('fas');
                    }
                    // location.reload();
                })
                .catch(error => console.error(error));
        }
    });



</script>
</html>